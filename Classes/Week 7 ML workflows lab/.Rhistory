#library(spdep)
library(blockCV)
library(sf)
library(dplyr)
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
data_sp <- data %>% mutate(presence = as.numeric(presence ))
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
vario <- cv_spatial_autocor(
x = sf_data,
column = "presence",
progress = T, plot = T
)
plot(vario$variograms[[1]]$exp_var$dist, vario$variograms[[1]]$exp_var$gamma)
detach("package:spdep", unload = TRUE)
#library(spdep)
library(blockCV)
library(sf)
library(dplyr)
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
data_sp <- data %>% mutate(presence = as.numeric(presence ))
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
vario <- cv_spatial_autocor(
x = sf_data,
column = "presence",
progress = T, plot = T
)
plot(vario$variograms[[1]]$exp_var$dist, vario$variograms[[1]]$exp_var$gamma)
sf_data
type(sf_data)
typeof(sf_data)
??sf::st_as_sf
?caret::train
library(dplyr)
library(reshape2)
library(ggplot2)
library(lubridate)
library(randomForest)
# Data on species presence
species_data <- read.csv("raw_data/CATCH AND HAUL DATA .csv")
# Data on abiotic conditions at survey stations
haul_data <- read.csv("raw_data/HAUL_DATA.csv")
#### Time series of climate conditions in the Bering Sea ###
# spring time algae blooms
bloom_data <- read.csv("raw_data/bloom_timing.csv")
bloom_data <- bloom_data %>% mutate(Survey.year = year) %>%
select(Survey.year, north_south, globcolour_peak_mean) %>%
dcast(Survey.year~north_south)
names(bloom_data) <- c("Survey.year","blooms_north","blooms_south")
# sea ice cover
ice_data <- read.csv("raw_data/ice.csv") %>%
mutate(Survey.year = year) %>% select(-year)
species_data <- species_data %>%
filter(Taxon.common.name == "snow crab") %>%
select(Haul.ID,Number.CPUE..no.km2.)
species_data
# select haul IDs without the species
no_crab_Haul.IDs  <- haul_data$Haul.ID[!(haul_data$Haul.ID %in% species_data$Haul.ID )]
data_no_species <- data.frame(Haul.ID=no_crab_Haul.IDs,Number.CPUE..no.km2.=0 )
species_data <- rbind(data_no_species, species_data)
data <- merge(species_data, haul_data, by ="Haul.ID")%>%
select(Haul.ID,Bottom.temperature..degrees.Celsius.,
Surface.temperature..degrees.Celsius.,Depth..m.,
Survey.year,Start.latitude..decimal.degrees.,
Start.longitude..decimal.degrees.,Date.and.time,
Number.CPUE..no.km2. )
data$Day.of.year <- yday(dmy(substr(data$Date.and.time,1,11)))
data <- data %>% select(-Date.and.time)
head(data)
data <- merge(data,bloom_data,by = "Survey.year")%>%
merge(ice_data,by = "Survey.year")
data$presence <- data$Number.CPUE..no.km2. > 0.0
data <- data %>% select(-Number.CPUE..no.km2.)
X <- data %>% select(-Survey.year, -presence)
y <- data %>% select( Haul.ID, presence)
X <- as.data.frame(scale(X))
X$Haul.ID <- data$Haul.ID
data <- merge(y,X,by = "Haul.ID")
data <- na.omit(data)
df <- data %>% select(-Start.latitude..decimal.degrees.,
-Start.longitude..decimal.degrees.,
- Haul.ID)
N <- nrow(df)
test_inds <- sample(1:N,round(N/5))
training <-df[test_inds,]
testing <-df[-test_inds,]
training <- training %>% mutate(presence= as.factor(presence))
testing <- testing %>% mutate(presence=as.factor(presence))
library(caret)
tuneGrid <- expand.grid(.mtry = c(2,4,8))
trainControl <- trainControl(method = "cv", number = 4)
mod <- train(presence~ .,
data = training ,
method = "rf",
trControl = trainControl, tuneGrid = tuneGrid)
mod <- train(outcome ~ predictors,
data = datat_set ,
method ="model type",
trControl = trainControl(method = "cv", number = k_folds),
tuneGrid = expand.grid(hyper_paramters = values))
#library(spdep)
library(blockCV)
library(sf)
library(dplyr)
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
data_sp <- data %>% mutate(presence = as.numeric(presence ))
library(blockCV)
library(sf)
# convert data fram e to SF
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
# calcualte sptail autocorrelation
correlations <- cv_spatial_autocor(
x = sf_data,
column = "variable",
progress = T, plot = T)
#library(spdep)
library(blockCV)
library(sf)
library(dplyr)
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
data_sp <- data %>% mutate(presence = as.numeric(presence ))
library(blockCV)
library(sf)
# convert data fram e to SF
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
# calcualte sptail autocorrelation
correlations <- cv_spatial_autocor(
x = sf_data,
column = "presence",
progress = T, plot = T)
# split up the data set
spatial_cv <- cv_spatial(x = sf_data,
column = "presence",
size = correlations$range,
k = 5)
head(data)
data %>% select(-Start.latitude..decimal.degrees., -Start.longitude..decimal.degrees.) %>% head()
data %>% mutate(Bottom.temperature... = Bottom.temperature..degrees.Celsius.,) %>% select(-Start.latitude..decimal.degrees., -Start.longitude..decimal.degrees.) %>% head()
data %>% mutate(Bottom.temperature... = Bottom.temperature..degrees.Celsius.,Surface.temperature...=Surface.temperature..degrees.Celsius.) %>% select(-Start.latitude..decimal.degrees., -Start.longitude..decimal.degrees.,-Surface.temperature..degrees.Celsius.,-Bottom.temperature..degrees.Celsius.) %>% head()
library(dplyr)
library(reshape2)
library(ggplot2)
library(lubridate)
library(caret)
library(blockCV)
library(sf)
# Data on species presence
species_data <- read.csv("raw_data/CATCH AND HAUL DATA .csv")
# Data on abiotic conditions at survey stations
haul_data <- read.csv("raw_data/HAUL_DATA.csv")
#### Time series of climate conditions in the Bering Sea ###
# spring time algae blooms
bloom_data <- read.csv("raw_data/bloom_timing.csv")
bloom_data <- bloom_data %>% mutate(Survey.year = year) %>%
select(Survey.year, north_south, globcolour_peak_mean) %>%
dcast(Survey.year~north_south)
names(bloom_data) <- c("Survey.year","blooms_north","blooms_south")
# sea ice cover
ice_data <- read.csv("raw_data/ice.csv") %>%
mutate(Survey.year = year) %>% select(-year)
species_data <- species_data %>%
filter(Taxon.common.name == "snow crab") %>%
select(Haul.ID,Number.CPUE..no.km2.)
species_data
df <- data %>% select(-Start.latitude..decimal.degrees.,
-Start.longitude..decimal.degrees.,
- Haul.ID)
N <- nrow(df)
test_inds <- sample(1:N,round(N/5))
training <-df[test_inds,]
testing <-df[-test_inds,]
library(dplyr)
library(reshape2)
library(ggplot2)
library(lubridate)
library(caret)
library(blockCV)
library(sf)
# Data on species presence
species_data <- read.csv("raw_data/CATCH AND HAUL DATA .csv")
# Data on abiotic conditions at survey stations
haul_data <- read.csv("raw_data/HAUL_DATA.csv")
#### Time series of climate conditions in the Bering Sea ###
# spring time algae blooms
bloom_data <- read.csv("raw_data/bloom_timing.csv")
bloom_data <- bloom_data %>% mutate(Survey.year = year) %>%
select(Survey.year, north_south, globcolour_peak_mean) %>%
dcast(Survey.year~north_south)
names(bloom_data) <- c("Survey.year","blooms_north","blooms_south")
# sea ice cover
ice_data <- read.csv("raw_data/ice.csv") %>%
mutate(Survey.year = year) %>% select(-year)
species_data <- species_data %>%
filter(Taxon.common.name == "snow crab") %>%
select(Haul.ID,Number.CPUE..no.km2.)
species_data
# select haul IDs without the species
no_crab_Haul.IDs  <- haul_data$Haul.ID[!(haul_data$Haul.ID %in% species_data$Haul.ID )]
data_no_species <- data.frame(Haul.ID=no_crab_Haul.IDs,Number.CPUE..no.km2.=0 )
species_data <- rbind(data_no_species, species_data)
data <- merge(species_data, haul_data, by ="Haul.ID")%>%
select(Haul.ID,Bottom.temperature..degrees.Celsius.,
Surface.temperature..degrees.Celsius.,Depth..m.,
Survey.year,Start.latitude..decimal.degrees.,
Start.longitude..decimal.degrees.,Date.and.time,
Number.CPUE..no.km2. )
data$Day.of.year <- yday(dmy(substr(data$Date.and.time,1,11)))
data <- data %>% select(-Date.and.time)
head(data)
data <- merge(data,bloom_data,by = "Survey.year")%>%
merge(ice_data,by = "Survey.year")
data$presence <- data$Number.CPUE..no.km2. > 0.0
data <- data %>% select(-Number.CPUE..no.km2.)
X <- data %>% select(-Survey.year, -presence)
y <- data %>% select( Haul.ID, presence)
X <- as.data.frame(scale(X))
X$Haul.ID <- data$Haul.ID
data <- merge(y,X,by = "Haul.ID")
data <- na.omit(data)
df <- data %>% select(-Start.latitude..decimal.degrees.,
-Start.longitude..decimal.degrees.,
- Haul.ID)
N <- nrow(df)
test_inds <- sample(1:N,round(N/5))
training <-df[test_inds,]
testing <-df[-test_inds,]
training <- training %>% mutate(presence= as.factor(presence))
testing <- testing %>% mutate(presence=as.factor(presence))
training <- training %>% mutate(presence= as.factor(presence))
testing <- testing %>% mutate(presence=as.factor(presence))
training <- training %>% mutate(presence= as.factor(presence))
testing <- testing %>% mutate(presence=as.factor(presence))
library(caret)
tuneGrid <- expand.grid(.mtry = c(2,4,8))
trainControl <- trainControl(method = "cv", number = 4)
mod <- train(presence~ .,
data = training ,
method = "rf",
trControl = trainControl, tuneGrid = tuneGrid)
mod <- train(outcome ~ predictors,
data = datat_set ,
method ="model type",
trControl = trainControl(method = "cv", number = k_folds),
tuneGrid = expand.grid(hyper_paramters = values))
library(pROC)
preds <- predict(mod, testing, type = "prob")
roc_obj <- roc(as.numeric(testing$presence)-1, preds$`TRUE`)
plot(roc_obj, main = "ROC Curve Example")
auc(roc_obj)
library(ggplot2)
var_imp <- varImp(mod,useModel=F)
importance <- var_imp$importance
importance$variable <- rownames(importance)
ggplot(importance, aes(x = TRUE., y = variable))+
geom_point()+theme_classic()
library(pdp)
partial(mod, "Bottom.temperature..degrees.Celsius.", train = data,
prob = TRUE, which.class = "TRUE", plot = TRUE)
#library(spdep)
library(blockCV)
library(sf)
library(dplyr)
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
data_sp <- data %>% mutate(presence = as.numeric(presence ))
library(blockCV)
library(sf)
# convert data fram e to SF
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
# calcualte sptail autocorrelation
correlations <- cv_spatial_autocor(
x = sf_data,
column = "presence",
progress = T, plot = T)
# split up the data set
spatial_cv <- cv_spatial(x = sf_data,
column = "presence",
size = correlations$range,
k = 5)
# set latitude and logitude columns
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
# convert presence - absence data back to a numeric value
data_sp <- data %>% mutate(presence = as.numeric(presence ))
# convert data frame to SF
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
# calculate spatial autocorrelation
correlations <- cv_spatial_autocor(
x = sf_data,
column = "presence",
progress = T, plot = T)
# split up the data set
spatial_cv <- cv_spatial(x = sf_data,
column = "presence",
size = correlations$range,
k = 5)
spatial_cv <- cv_spatial(x = sf_data, column = "presence", size = vario$range, k = 5)
# set latitude and logitude columns
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
# convert presence - absence data back to a numeric value
data_sp <- data %>% mutate(presence = as.numeric(presence ))
# convert data frame to SF
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
# calculate spatial autocorrelation
correlations <- cv_spatial_autocor(
x = sf_data,
column = "presence",
progress = T, plot = T)
# split up the data set
spatial_cv <- cv_spatial(x = sf_data,
column = "presence",
size = correlations$range,
k = 5)
# set latitude and logitude columns
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
# convert presence - absence data back to a numeric value
data_sp <- data %>% mutate(presence = as.numeric(presence ))
# convert data frame to SF
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
# calculate spatial autocorrelation
correlations <- cv_spatial_autocor(
x = sf_data,
column = "presence",
progress = T, plot = T)
correlations$variograms[[1]]
# set latitude and logitude columns
lat <- "Start.latitude..decimal.degrees."
lon <- "Start.longitude..decimal.degrees."
# convert presence - absence data back to a numeric value
data_sp <- data %>% mutate(presence = as.numeric(presence ))
# convert data frame to SF
sf_data <- st_as_sf(data_sp, coords = c(lon, lat), crs = 4326)
# calculate spatial autocorrelation
correlations <- cv_spatial_autocor(
x = sf_data,
column = "presence",
progress = T, plot = T)
distance <- correlations$variograms[[1]]$exp_var$dist
semi_var <- correlations$variograms[[1]]$exp_var$gamma
plot(distance,semi_var, xlab = "Distance (m)", ylab = "Semivar (gamma)")
# split up the data set
spatial_cv <- cv_spatial(x = sf_data,
column = "presence",
size = correlations$range,
k = 5)
# split up the data set
spatial_cv <- cv_spatial(x = sf_data,
column = "presence",
size = correlations$range,
k = 5)
testing <- data_sp[spatial_cv$folds_ids == 5,]
training <- data_sp[spatial_cv$folds_ids != 5,]
training <- training %>% mutate(presence=as.factor(presence == 1))
testing <- testing %>% mutate(presence=as.factor(presence == 1))
sf_training <- st_as_sf(training, coords = c(lon, lat), crs = 4326)
spatial_cv <- cv_spatial(x = sf_training, column = "presence", size = vario$range, k = 4)
sf_training <- st_as_sf(training, coords = c(lon, lat), crs = 4326)
spatial_cv <- cv_spatial(x = sf_training, column = "presence", size = correlations$range, k = 4)
library(caret)
index_in <- lapply(spatial_cv$folds_list, `[[`, 1)
index_out <- lapply(spatial_cv$folds_list, `[[`, 2)
trainControl_blocks <- trainControl(
method = "cv",
number = length(index_in),
index  = index_in,
indexOut = index_out
)
tuneGrid <- expand.grid(.mtry = c(2, 5))
trainControl <- trainControl(method = "cv", number = 5)
training <- training %>% select(-Start.latitude..decimal.degrees.,
-Start.longitude..decimal.degrees.)
mod <- train(presence ~ ., data = training, method = "rf",
trControl = trainControl_blocks, tuneGrid = tuneGrid)
mod
library(pROC)
preds <- predict(mod, testing, type = "prob")
roc_obj <- roc(as.numeric(testing$presence)-1, preds$`TRUE`)
plot(roc_obj, main = "ROC Curve Example")
auc(roc_obj)
library(pROC)
# get probabilities from model
preds <- predict(mod, testing, type = "prob")
# calcualte reciever operator characteristics
roc_obj <- roc(testing$variable, preds$`TRUE`)
preds$`TRUE`
testing$variable
testing
testing$presence
library(pROC)
preds <- predict(mod, testing, type = "prob")
roc_obj <- roc(as.numeric(testing$presence)-1, preds$`TRUE`)
plot(roc_obj, main = "ROC Curve Example")
auc(roc_obj)
library(pROC)
# get probabilities from model
preds <- predict(mod, testing, type = "prob")
# calcualte reciever operator characteristics
roc_obj <- roc(testing$presence, preds$`TRUE`)
# make reciever operator plot
plot(roc_obj, main = "ROC Curve Example")
# calcualte area under the curve metric
auc(roc_obj)
library(pROC)
preds <- predict(mod, testing, type = "prob")
roc_obj <- roc(as.numeric(testing$presence)-1, preds$`TRUE`)
plot(roc_obj, main = "ROC Curve Example")
auc(roc_obj)
# split up the data set
spatial_cv <- cv_spatial(x = sf_data,
column = "presence",
size = correlations$range,
k = 5)
testing <- data_sp[spatial_cv$folds_ids == 5,]
training <- data_sp[spatial_cv$folds_ids != 5,]
training <- training %>% mutate(presence=as.factor(presence == 1))
testing <- testing %>% mutate(presence=as.factor(presence == 1))
sf_training <- st_as_sf(training, coords = c(lon, lat), crs = 4326)
spatial_cv <- cv_spatial(x = sf_training, column = "presence", size = correlations$range, k = 4)
library(caret)
index_in <- lapply(spatial_cv$folds_list, `[[`, 1)
index_out <- lapply(spatial_cv$folds_list, `[[`, 2)
trainControl_blocks <- trainControl(
method = "cv",
number = length(index_in),
index  = index_in,
indexOut = index_out
)
tuneGrid <- expand.grid(.mtry = c(2, 5))
trainControl <- trainControl(method = "cv", number = 5)
training <- training %>% select(-Start.latitude..decimal.degrees.,
-Start.longitude..decimal.degrees.)
mod <- train(presence ~ ., data = training, method = "rf",
trControl = trainControl_blocks, tuneGrid = tuneGrid)
mod
library(pROC)
preds <- predict(mod, testing, type = "prob")
roc_obj <- roc(as.numeric(testing$presence)-1, preds$`TRUE`)
plot(roc_obj, main = "ROC Curve Example")
auc(roc_obj)
library(ggplot2)
var_imp <- varImp(mod,useModel=F)
importance <- var_imp$importance
importance$variable <- rownames(importance)
ggplot(importance, aes(x = TRUE., y = variable))+
geom_point()+theme_classic()
library(pdp)
partial(mod, "Depth..m.", train = training,
prob = TRUE, which.class = "TRUE", plot = TRUE)
library(ggplot2)
library(sf)
library(rnaturalearth)
install.packages("rnaturalearth")
install.packages("rnaturalearthdata")
library(ggplot2)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(dplyr)
# Get world map data as sf object
world <- ne_countries(scale = "medium", returnclass = "sf")
# Filter for  USA (includes Alaska)
bering_countries <- world %>%
filter(admin %in% c("United States of America"))
# Define plot limits (Bering Sea area)
xlim <- c(-179,-150); ylim <- c(50, 75)
# Plot
ggplot() +
geom_sf(data = bering_countries, fill = "lightgray", color = "black") +
coord_sf(xlim = xlim, ylim = ylim, expand = FALSE) +
theme_minimal() +
geom_point(data = AGFTS,
mapping = aes(x = Start.longitude..decimal.degrees.,
y = Start.latitude..decimal.degrees.),
size = 0.25)
setwd("/Users/johnbuckner/Documents/ML_workflows_lab")
AGFTS <- read.csv("raw_data/CATCH AND HAUL DATA .csv")
head(AGFTS)
unique(AGFTS$Taxon.common.name)
names(AGFTS)
library(ggplot2)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(dplyr)
# Get world map data as sf object
world <- ne_countries(scale = "medium", returnclass = "sf")
# Filter for  USA (includes Alaska)
bering_countries <- world %>%
filter(admin %in% c("United States of America"))
# Define plot limits (Bering Sea area)
xlim <- c(-179,-150); ylim <- c(50, 75)
# Plot
ggplot() +
geom_sf(data = bering_countries, fill = "lightgray", color = "black") +
coord_sf(xlim = xlim, ylim = ylim, expand = FALSE) +
theme_minimal() +
geom_point(data = AGFTS,
mapping = aes(x = Start.longitude..decimal.degrees.,
y = Start.latitude..decimal.degrees.),
size = 0.25)
library(caret)
tuneGrid <- expand.grid(.mtry = c(2,4,8))
trainControl <- trainControl(method = "cv", number = 4)
mod <- train(presence~ .,
data = training ,
method = "rf",
trControl = trainControl, tuneGrid = tuneGrid)
